(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{343:function(e,t,r){"use strict";r.r(t);var s=r(4),a=Object(s.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h2",{attrs:{id:"keys"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#keys"}},[e._v("#")]),e._v(" keys")]),e._v(" "),r("p",[e._v("有个需求需要获取全部的key，本来想用"),r("code",[e._v("keys pattern*")]),e._v("，后来看到文章里面写生产环境最好不用"),r("code",[e._v("keys")]),e._v("命令，可以用"),r("code",[e._v("scan")]),e._v("命令。看了下文档，里面有这么一句：")]),e._v(" "),r("blockquote",[r("p",[r("strong",[e._v("Warning")]),e._v(": consider "),r("a",{attrs:{href:"https://redis.io/commands/keys",target:"_blank",rel:"noopener noreferrer"}},[e._v("KEYS"),r("OutboundLink")],1),e._v(" as a command that should only be used in production environments with extreme care. It may ruin performance when it is executed against large databases.")]),e._v(" "),r("p",[e._v("Don't use "),r("a",{attrs:{href:"https://redis.io/commands/keys",target:"_blank",rel:"noopener noreferrer"}},[e._v("KEYS"),r("OutboundLink")],1),e._v(" in your regular application code. If you're looking for a way to find keys in a subset of your keyspace, consider using "),r("a",{attrs:{href:"https://redis.io/commands/scan",target:"_blank",rel:"noopener noreferrer"}},[e._v("SCAN"),r("OutboundLink")],1),e._v(" or "),r("a",{attrs:{href:"https://redis.io/topics/data-types#sets",target:"_blank",rel:"noopener noreferrer"}},[e._v("sets"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("大概意思是说"),r("code",[e._v("keys")]),e._v("命令用在生产环境时要非常谨慎，当数据量很大时可能会崩溃。不要在代码中用"),r("code",[e._v("keys")]),e._v("命令，想获取"),r("code",[e._v("key")]),e._v("时可以用"),r("code",[e._v("scan")]),e._v("或是"),r("code",[e._v("set")])])]),e._v(" "),r("p",[e._v("我本地试了下往redis中插入了5W个key，用"),r("code",[e._v("keys key:*")]),e._v("查看，速度还是很快")]),e._v(" "),r("img",{staticStyle:{width:"150px"},attrs:{src:"/img/redis/scan1.jpg"}}),e._v(" "),r("p",[e._v("当插入了10W个key，再用"),r("code",[e._v("keys key:*")]),e._v("查看，速度就明显慢下来了，花了0.7S。已经是很慢了。")]),e._v(" "),r("img",{staticStyle:{width:"150px"},attrs:{src:"/img/redis/scan2.jpg"}}),e._v(" "),r("h2",{attrs:{id:"scan"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#scan"}},[e._v("#")]),e._v(" scan")]),e._v(" "),r("p",[r("code",[e._v("scan")]),e._v("命令的文档")]),e._v(" "),r("blockquote",[r("p",[e._v("returning only a small number of elements per call, they can be used in production without the downside of commands like "),r("a",{attrs:{href:"https://redis.io/commands/keys",target:"_blank",rel:"noopener noreferrer"}},[e._v("KEYS"),r("OutboundLink")],1),e._v(" or "),r("a",{attrs:{href:"https://redis.io/commands/smembers",target:"_blank",rel:"noopener noreferrer"}},[e._v("SMEMBERS"),r("OutboundLink")],1),e._v(" that may block the server for a long time (even several seconds) when called against big collections of keys or elements.")]),e._v(" "),r("p",[e._v("每次执行该命令只返回总元素的一小部分。这些"),r("code",[e._v("scan")]),e._v("系列的命令（"),r("code",[e._v("scan, sscan, hscan, zscan")]),e._v("命令的作用类似）可以用在生产环境。不像"),r("code",[e._v("keys")]),e._v("或者"),r("code",[e._v("smembers")]),e._v("命令，当数据量很大时，可能会阻塞很久（甚至好几秒）。")]),e._v(" "),r("p",[e._v("However while blocking commands like "),r("a",{attrs:{href:"https://redis.io/commands/smembers",target:"_blank",rel:"noopener noreferrer"}},[e._v("SMEMBERS"),r("OutboundLink")],1),e._v(" are able to provide all the elements that are part of a Set in a given moment, The SCAN family of commands only offer limited guarantees about the returned elements since the collection that we incrementally iterate can change during the iteration process.")]),e._v(" "),r("p",[e._v("像"),r("code",[e._v("smembers")]),e._v("这种会阻塞的命令，一次返回所有元素。"),r("code",[e._v("scan")]),e._v("系列的命令只能对返回的元素提供有限的保证。因为在迭代过程中，增量迭代的元数据可能会改变")])]),e._v(" "),r("p",[r("code",[e._v("scan")]),e._v("命令是一个基于游标的迭代器，每次游标从0开始，每次命令执行完会返回一个新的游标，用于下次迭代。当返回的游标是0时，迭代结束。")]),e._v(" "),r("p",[e._v("事先创建了30个key。使用"),r("code",[e._v("scan")]),e._v("命令迭代：")]),e._v(" "),r("img",{staticStyle:{width:"230px"},attrs:{src:"/img/redis/scan3.jpg"}}),e._v(" "),r("p",[e._v("可以看出来，一共迭代了三次，每次迭代都会返回两个值，第一个是更新后的cursor，第二个是结果集")]),e._v(" "),r("h2",{attrs:{id:"本机环境"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#本机环境"}},[e._v("#")]),e._v(" 本机环境")]),e._v(" "),r("p",[e._v("MacOS 10.15.3")]),e._v(" "),r("p",[e._v("8G内存 四核八代i5")]),e._v(" "),r("h2",{attrs:{id:"参考链接"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[e._v("#")]),e._v(" 参考链接")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://redis.io/commands/keys",target:"_blank",rel:"noopener noreferrer"}},[e._v("redis-keys"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://redis.io/commands/scan",target:"_blank",rel:"noopener noreferrer"}},[e._v("redis-scan"),r("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=a.exports}}]);